
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Syncthing Discovery Server &#8212; Syncthing v1.22.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/version_redirect.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Syncthing Relay Server" href="strelaysrv.html" />
    <link rel="prev" title="File Versioning" href="versioning.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="syncthing-discovery-server">
<h1>Syncthing Discovery Server<a class="headerlink" href="#syncthing-discovery-server" title="Permalink to this headline">¶</a></h1>
<section id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stdiscosrv</span> <span class="p">[</span><span class="o">-</span><span class="n">cert</span><span class="o">=&lt;</span><span class="n">file</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">db</span><span class="o">-</span><span class="nb">dir</span><span class="o">=&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">debug</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">http</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">key</span><span class="o">=&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">]</span>
           <span class="p">[</span><span class="o">-</span><span class="n">listen</span><span class="o">=&lt;</span><span class="n">address</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">metrics</span><span class="o">-</span><span class="n">listen</span><span class="o">=&lt;</span><span class="n">address</span><span class="o">&gt;</span><span class="p">]</span>
           <span class="p">[</span><span class="o">-</span><span class="n">replicate</span><span class="o">=&lt;</span><span class="n">peers</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">replication</span><span class="o">-</span><span class="n">listen</span><span class="o">=&lt;</span><span class="n">address</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Syncthing relies on a discovery server to find peers on the internet. Anyone
can run a discovery server and point Syncthing installations to it. The
Syncthing project also maintains a global cluster for public use.</p>
</section>
<section id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-cert">
<span class="sig-name descname"><span class="pre">-cert</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;file&gt;</span></span><a class="headerlink" href="#cmdoption-cert" title="Permalink to this definition">¶</a></dt>
<dd><p>Certificate file (default “./cert.pem”).</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-db-dir">
<span class="sig-name descname"><span class="pre">-db-dir</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;string&gt;</span></span><a class="headerlink" href="#cmdoption-db-dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Database directory, where data is stored (default “./discovery.db”).</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-debug">
<span class="sig-name descname"><span class="pre">-debug</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-debug" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable debug output.</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-http">
<span class="sig-name descname"><span class="pre">-http</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-http" title="Permalink to this definition">¶</a></dt>
<dd><p>Listen on HTTP (behind an HTTPS proxy).</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-key">
<span class="sig-name descname"><span class="pre">-key</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;file&gt;</span></span><a class="headerlink" href="#cmdoption-key" title="Permalink to this definition">¶</a></dt>
<dd><p>Key file (default “./key.pem”).</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-listen">
<span class="sig-name descname"><span class="pre">-listen</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;address&gt;</span></span><a class="headerlink" href="#cmdoption-listen" title="Permalink to this definition">¶</a></dt>
<dd><p>Listen address (default “:8443”).</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-metrics-listen">
<span class="sig-name descname"><span class="pre">-metrics-listen</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;address&gt;</span></span><a class="headerlink" href="#cmdoption-metrics-listen" title="Permalink to this definition">¶</a></dt>
<dd><p>Prometheus compatible metrics endpoint listen address (default disabled).</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-replicate">
<span class="sig-name descname"><span class="pre">-replicate</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;peers&gt;</span></span><a class="headerlink" href="#cmdoption-replicate" title="Permalink to this definition">¶</a></dt>
<dd><p>Replication peers, <a class="reference external" href="mailto:id&#37;&#52;&#48;address">id<span>&#64;</span>address</a>, comma separated</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-replication-listen">
<span class="sig-name descname"><span class="pre">-replication-listen</span></span><span class="sig-prename descclassname"><span class="pre">=&lt;address&gt;</span></span><a class="headerlink" href="#cmdoption-replication-listen" title="Permalink to this definition">¶</a></dt>
<dd><p>Listen address for incoming replication connections (default “:19200”).</p>
</dd></dl>

</section>
<section id="pointing-syncthing-at-your-discovery-server">
<h2>Pointing Syncthing at Your Discovery Server<a class="headerlink" href="#pointing-syncthing-at-your-discovery-server" title="Permalink to this headline">¶</a></h2>
<p>By default, Syncthing uses a number of global discovery servers, signified by
the entry <code class="docutils literal notranslate"><span class="pre">default</span></code> in the list of discovery servers. To make Syncthing use
your own instance of stdiscosrv, open up Syncthing’s web GUI. Go to settings,
Global Discovery Server and add stdiscosrv’s host address to the comma-separated
list, e.g. <code class="docutils literal notranslate"><span class="pre">https://disco.example.com:8443/</span></code>. Note that stdiscosrv uses port
8443 by default. For stdiscosrv to be available over the internet with a dynamic
IP address, you will need a dynamic DNS service.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version v0.14.44: </span>Prior versions need <code class="docutils literal notranslate"><span class="pre">/v2/</span></code> appended to the discovery
server address, e.g. <code class="docutils literal notranslate"><span class="pre">https://disco.example.com:8443/v2/</span></code>.</p>
</div>
<p>If you wish to use <em>only</em> your own discovery server, remove the <code class="docutils literal notranslate"><span class="pre">default</span></code>
entry from the list.</p>
</section>
<section id="setting-up">
<h2>Setting Up<a class="headerlink" href="#setting-up" title="Permalink to this headline">¶</a></h2>
<section id="id1">
<h3>Description<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>This guide assumes that you have already set up Syncthing. If you
haven’t yet, head over to <a class="reference internal" href="../intro/getting-started.html#getting-started"><span class="std std-ref">Getting Started</span></a> first.</p>
</section>
<section id="installing">
<h3>Installing<a class="headerlink" href="#installing" title="Permalink to this headline">¶</a></h3>
<p>Go to <a class="reference external" href="https://github.com/syncthing/discosrv/releases">releases</a> and
download the file appropriate for your operating system. Unpacking it will
yield a binary called <code class="docutils literal notranslate"><span class="pre">stdiscosrv</span></code> (or <code class="docutils literal notranslate"><span class="pre">stdiscosrv.exe</span></code> on Windows).
Start this in whatever way you are most comfortable with; double clicking
should work in any graphical environment. At first start, stdiscosrv will
generate certificate files and database in the current directory unless
given flags to the contrary.</p>
<p>The discovery server can also be obtained through apt, the Debian/Ubuntu package
manager. Recent releases can be found at syncthing’s
<a class="reference external" href="https://apt.syncthing.net/">apt repository</a>. The name of the package is
syncthing-discosrv.</p>
</section>
<section id="configuring">
<h3>Configuring<a class="headerlink" href="#configuring" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are running an instance of Syncthing on the discovery server,
you must either add that instance to other devices using a static
address or bind the discovery server and Syncthing instances to
different IP addresses.</p>
</div>
<section id="certificates">
<h4>Certificates<a class="headerlink" href="#certificates" title="Permalink to this headline">¶</a></h4>
<p>The discovery server provides service over HTTPS. To ensure secure connections
from clients there are three options:</p>
<ul class="simple">
<li><p>Use a CA-signed certificate pair for the domain name you will use for the
discovery server. This is like any other HTTPS website; clients will
authenticate the server based on its certificate and domain name.</p></li>
<li><p>Use any certificate pair and let clients authenticate the server based on
its “device ID” (similar to Syncthing-to-Syncthing authentication). This
option can be used with the certificate automatically generated by the
discovery server.</p></li>
<li><p>Pass the <code class="docutils literal notranslate"><span class="pre">-http</span></code> flag if the discovery server is behind an SSL-secured
reverse proxy. See below for configuration.</p></li>
</ul>
<p>For the first two options, the discovery server must be given the paths to
the certificate and key at startup. This isn’t necessary with the <code class="docutils literal notranslate"><span class="pre">http</span></code> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ stdiscosrv -cert=/path/to/cert.pem -key=/path/to/key.pem
Server device ID is 7DDRT7J-UICR4PM-PBIZYL3-MZOJ7X7-EX56JP6-IK6HHMW-S7EK32W-G3EUPQA
</pre></div>
</div>
<p>The discovery server prints its device ID at startup. In case you are using
a non CA signed certificate, this device ID (fingerprint) must be given to
the clients in the discovery server URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://disco.example.com:8443/?id=7DDRT7J-UICR4PM-PBIZYL3-MZOJ7X7-EX56JP6-IK6HHMW-S7EK32W-G3EUPQA
</pre></div>
</div>
<p>Otherwise, the URL will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">disco</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">8443</span><span class="o">/</span>
</pre></div>
</div>
</section>
<section id="replication">
<h4>Replication<a class="headerlink" href="#replication" title="Permalink to this headline">¶</a></h4>
<p>The discovery server can be deployed in a redundant, load sharing fashion.
In this mode announcements are replicated from the server that receives them
to other peer servers and queries can be answered equally by all servers.</p>
<p>Replication connections are encrypted and authenticated using TLS. The
certificate is selected by the <code class="docutils literal notranslate"><span class="pre">-cert</span></code> and <code class="docutils literal notranslate"><span class="pre">-key</span></code> options and is thus
shared with the main discovery API. If the <code class="docutils literal notranslate"><span class="pre">-http</span></code> mode is used the
certificate is not used for client requests but only for replication
connections.</p>
<p>Authentication of replication connections is done using <a class="reference external" href="https://docs.syncthing.net/dev/device-ids.html#id1">Syncthing-style
device IDs</a> only - CA
verification is not available. The device IDs in question are those printed
by the discovery server on startup.</p>
<p>Replication connections are unidirectional - announcements are replication
from the <strong>sender</strong> to a <strong>listener</strong>. In order to have a bidirectional
replication relationship between two servers both need to be configured as
sender and listener.</p>
<p>As an example, lets assume two discovery servers:</p>
<ul class="simple">
<li><p>Server one is on 192.0.2.20 and has certificate ID I6K…H76</p></li>
<li><p>Server two is on 192.0.2.55 and has certificate ID MRI…7OK</p></li>
</ul>
<p>In order for both to replicate to the other and thus form a redundant pair,
use the following commands.</p>
<p>On server one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ stdiscosrv -replicate=MRI...7OK@192.0.2.55:19200 &lt;other options&gt;
</pre></div>
</div>
<p>On server two:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ stdiscosrv -replicate=I6K...H76@192.0.2.20:19200 &lt;other options&gt;
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-replicate</span></code> directive sets which remote device IDs are expected and
allowed for both outgoing (sending) and incoming (listening) connections,
and which addresses to use when connecting out to those peers. Both IP and
port must be specified in peer addresses.</p>
<p>It is possible to only allow incoming connections from a peer without
establishing an outgoing replication connection. To do so, give only the
device ID without “&#64;ip:port” address:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ stdiscosrv -replicate=I6K...H76 &lt;other options&gt;
</pre></div>
</div>
<p>Discosrv will listen on the replication port only when <code class="docutils literal notranslate"><span class="pre">-replicate</span></code> is
given. The default replication listen address is “:19200”.</p>
<p>To achieve load balancing over two mutually replicating discovery server
instances, add multiple A / AAAA DNS records for a given name and point
Syncthing towards this name. The same certificate must be used on both
discovery servers.</p>
</section>
</section>
<section id="reverse-proxy-setup">
<h3>Reverse Proxy Setup<a class="headerlink" href="#reverse-proxy-setup" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.8.0: </span>A new “X-Client-Port” HTTP header was added.</p>
</div>
<p>The discovery server can be run behind an SSL-secured reverse proxy. This
allows:</p>
<ul class="simple">
<li><p>Use of a subdomain name without requiring a port number added to the URL</p></li>
<li><p>Sharing an SSL certificate with multiple services on the same server</p></li>
</ul>
<p>Note that after this configuration, if the proxy uses a valid HTTPS
certificate, <strong>clients should omit the</strong> <code class="code docutils literal notranslate"><span class="pre">?id=...</span></code> <strong>parameter from the
discovery server URL on their configuration</strong>. Client-side validation will be
done by checking the visible proxy server’s HTTPS certificate. If, however, the
proxy uses a self-signed or somehow invalid certificate, clients must still set
the <code class="code docutils literal notranslate"><span class="pre">?id=...</span></code> parameter with the computed hash of the proxy’s
certificate. Using such setup is discouraged and is not covered in this page.
Always favour using valid and widely recognised certificates.</p>
<section id="requirements">
<h4>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Run the discovery server using the -http flag: <code class="code docutils literal notranslate"><span class="pre">stdiscosrv</span> <span class="pre">-http</span></code>.</p></li>
<li><p>SSL certificate/key configured for the reverse proxy.</p></li>
<li><p>The “X-Forwarded-For” HTTP header must be passed through with the client’s
real IP address.</p></li>
<li><p>The “X-Client-Port” HTTP header should be passed through, containing the client’s real connection port.</p></li>
<li><p>The “X-SSL-Cert” HTTP header must be passed through with the PEM-encoded
client SSL certificate. This will be present in POST requests and may be empty
in GET requests from clients. If you see syncthing-discosrv outputting
<code class="code docutils literal notranslate"><span class="pre">no</span> <span class="pre">certificates</span></code> when receiving POST requests, that’s because the proxy
is not passing this header through.</p></li>
<li><p>The proxy must request the client SSL certificate but not require it to be
signed by a trusted CA.</p></li>
</ul>
<section id="nginx">
<h5>Nginx<a class="headerlink" href="#nginx" title="Permalink to this headline">¶</a></h5>
<p>These lines in the configuration take care of the last four requirements
listed above:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span><span class="w"></span>
<span class="k">proxy_set_header</span><span class="w"> </span><span class="s">X-Client-Port</span><span class="w"> </span><span class="nv">$remote_port</span><span class="p">;</span><span class="w"></span>
<span class="k">proxy_set_header</span><span class="w"> </span><span class="s">X-SSL-Cert</span><span class="w"> </span><span class="nv">$ssl_client_cert</span><span class="p">;</span><span class="w"></span>
<span class="k">ssl_verify_client</span><span class="w"> </span><span class="s">optional_no_ca</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>The following is a complete example Nginx configuration file. With this setup,
clients can use <a class="reference external" href="https://discovery.example.com">https://discovery.example.com</a> as the discovery server URL in
the Syncthing settings.</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="c1"># HTTP 1.1 support</span>
<span class="k">proxy_http_version</span><span class="w"> </span><span class="mi">1</span><span class="s">.1</span><span class="p">;</span><span class="w"></span>
<span class="k">proxy_buffering</span><span class="w"> </span><span class="no">off</span><span class="p">;</span><span class="w"></span>
<span class="k">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$http_host</span><span class="p">;</span><span class="w"></span>
<span class="k">proxy_set_header</span><span class="w"> </span><span class="s">Upgrade</span><span class="w"> </span><span class="nv">$http_upgrade</span><span class="p">;</span><span class="w"></span>
<span class="k">proxy_set_header</span><span class="w"> </span><span class="s">Connection</span><span class="w"> </span><span class="nv">$http_connection</span><span class="p">;</span><span class="w"></span>
<span class="k">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span><span class="w"></span>
<span class="k">proxy_set_header</span><span class="w"> </span><span class="s">X-Client-Port</span><span class="w"> </span><span class="nv">$remote_port</span><span class="p">;</span><span class="w"></span>
<span class="k">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span><span class="w"></span>
<span class="k">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-Proto</span><span class="w"> </span><span class="nv">$http_x_forwarded_proto</span><span class="p">;</span><span class="w"></span>
<span class="k">proxy_set_header</span><span class="w"> </span><span class="s">X-SSL-Cert</span><span class="w"> </span><span class="nv">$ssl_client_cert</span><span class="p">;</span><span class="w"></span>
<span class="k">upstream</span><span class="w"> </span><span class="s">discovery.example.com</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Local IP address:port for discovery server</span>
<span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="n">192.0.2.1</span><span class="p">:</span><span class="mi">8443</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">server</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kn">server_name</span><span class="w"> </span><span class="s">discovery.example.com</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kn">access_log</span><span class="w"> </span><span class="s">/var/log/nginx/access.log</span><span class="w"> </span><span class="s">vhost</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kn">return</span><span class="w"> </span><span class="mi">301</span><span class="w"> </span><span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">server</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kn">server_name</span><span class="w"> </span><span class="s">discovery.example.com</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">443</span><span class="w"> </span><span class="s">ssl</span><span class="w"> </span><span class="s">http2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kn">access_log</span><span class="w"> </span><span class="s">/var/log/nginx/access.log</span><span class="w"> </span><span class="s">vhost</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1"># Mozilla Intermediate configuration (https://wiki.mozilla.org/Security/Server_Side_TLS)</span>
<span class="w">        </span><span class="kn">ssl_protocols</span><span class="w"> </span><span class="s">TLSv1.2</span><span class="w"> </span><span class="s">TLSv1.3</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kn">ssl_ciphers</span><span class="w"> </span><span class="s">ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kn">ssl_prefer_server_ciphers</span><span class="w"> </span><span class="no">off</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kn">ssl_session_tickets</span><span class="w"> </span><span class="no">off</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kn">ssl_session_timeout</span><span class="w"> </span><span class="mi">5m</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kn">ssl_session_cache</span><span class="w"> </span><span class="s">shared:SSL:50m</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kn">ssl_verify_client</span><span class="w"> </span><span class="s">optional_no_ca</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1"># OCSP stapling</span>
<span class="w">        </span><span class="kn">ssl_stapling</span><span class="w"> </span><span class="no">on</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kn">ssl_stapling_verify</span><span class="w"> </span><span class="no">on</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1"># Certificates</span>
<span class="w">        </span><span class="kn">ssl_certificate</span><span class="w"> </span><span class="s">/etc/nginx/certs/discovery.example.com.crt</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kn">ssl_certificate_key</span><span class="w"> </span><span class="s">/etc/nginx/certs/discovery.example.com.key</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1"># curl https://ssl-config.mozilla.org/ffdhe2048.txt &gt; /path/to/dhparam</span>
<span class="w">        </span><span class="kn">ssl_dhparam</span><span class="w"> </span><span class="s">/path/to/dhparam</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1"># HSTS (ngx_http_headers_module is required) (63072000 seconds)</span>
<span class="w">        </span><span class="kn">add_header</span><span class="w"> </span><span class="s">Strict-Transport-Security</span><span class="w"> </span><span class="s">&quot;max-age=63072000&quot;</span><span class="w"> </span><span class="s">always</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://discovery.example.com</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>An example of automating the SSL certificates and reverse-proxying the Discovery
Server and Syncthing using Nginx, <a class="reference external" href="https://letsencrypt.org/">Let’s Encrypt</a> and Docker can be found <a class="reference external" href="https://forum.syncthing.net/t/docker-syncthing-and-syncthing-discovery-behind-nginx-reverse-proxy-with-lets-encrypt/6880">here</a>.</p>
</section>
<section id="apache">
<h5>Apache<a class="headerlink" href="#apache" title="Permalink to this headline">¶</a></h5>
<p>The following lines must be added to the configuration:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nb">SSLProxyEngine</span><span class="w"> </span><span class="k">On</span><span class="w"></span>
<span class="nb">SSLVerifyClient</span><span class="w"> </span>optional_no_ca<span class="w"></span>
<span class="nb">RequestHeader</span><span class="w"> </span>set<span class="w"> </span>X-SSL-Cert<span class="w"> </span><span class="s2">&quot;%{SSL_CLIENT_CERT}s&quot;</span><span class="w"></span>
</pre></div>
</div>
<p>The following was observed to not be required at least under
Apache httpd 2.4.38, as the proxy module adds the needed header by default.
If you need to explicitly add the following directive, make sure to issue
<code class="code docutils literal notranslate"><span class="pre">a2enmod</span> <span class="pre">remoteip</span></code> first. Then, add the following to your Apache httpd
configuration:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nb">RemoteIPHeader</span><span class="w"> </span>X-Forwarded-For<span class="w"></span>
</pre></div>
</div>
<p>For more details, see also the recommendations in the
<a class="reference external" href="https://docs.syncthing.net/users/reverseproxy.html">Reverse Proxy Setup</a>
page. Note that that page is directed at setting up a proxy for the
Syncthing web UI. You should do the proper path and port adjustments to proxying
the discovery server and your particular setup.</p>
</section>
</section>
</section>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p><em class="manpage">syncthing-networking(7)</em>, <em class="manpage">syncthing-faq(7)</em></p>
</section>
</section>


          </div>
<div class="body footer-body" role="footer">
    <a class="reference external" href="https://github.com/syncthing/docs/edit/main/users/stdiscosrv.rst" rel="nofollow">Edit this page on GitHub</a>
    <br />
    <small>Version: v1.22.0-0-gbadd1d1</small>
</div>

          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo-horizontal.svg" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=syncthing&repo=syncthing&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<p>Written for v1.22.0</p>
<hr /><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="syncthing.html">Command Line Operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="releases.html">Versions &amp; Releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html">Advanced Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="foldertypes.html">Folder Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="introducer.html">Introducer Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="guilisten.html">The GUI Listen Address</a></li>
<li class="toctree-l2"><a class="reference internal" href="ldap.html">LDAP Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="syncing.html">Understanding Synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="untrusted.html">Untrusted (Encrypted) Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="firewall.html">Firewall Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="relaying.html">Relaying</a></li>
<li class="toctree-l2"><a class="reference internal" href="proxying.html">Using Proxies</a></li>
<li class="toctree-l2"><a class="reference internal" href="tunneling.html">SSH Tunneling</a></li>
<li class="toctree-l2"><a class="reference internal" href="ignoring.html">Ignoring Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="versioning.html">File Versioning</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Syncthing Discovery Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="strelaysrv.html">Syncthing Relay Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom-upgrades.html">Custom Upgrade Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="autostart.html">Starting Syncthing Automatically</a></li>
<li class="toctree-l2"><a class="reference internal" href="contrib.html">Community Contributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiling.html">Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="reverseproxy.html">Reverse Proxy Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Security Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="crashrep.html">Automatic Crash Reporting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../specs/index.html">Specifications</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Usage</a><ul>
      <li>Previous: <a href="versioning.html" title="previous chapter">File Versioning</a></li>
      <li>Next: <a href="strelaysrv.html" title="next chapter">Syncthing Relay Server</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>


<h3 class="donation">Donate/support</h3>



<p>
<a class="badge" href="https://syncthing.net/donations/">
<img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate">
</a>
</p>





        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
    </div>

    

    
  </body>
</html>